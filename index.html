<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€í•œë¯¼êµ­ ì‹¤ì‹œê°„ ì¼ê¸°ì˜ˆë³´</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        .select-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            width: 100%;
            justify-content: center;
        }
        select, button {
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            outline: none;
        }
        select {
            flex-grow: 1;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #weather-info {
            border-top: 2px solid #ecf0f1;
            padding-top: 20px;
            margin-top: 20px;
            text-align: center;
        }
        #weather-info h2 {
            color: #34495e;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .loading {
            text-align: center;
            font-size: 18px;
            color: #7f8c8d;
        }
        .error {
            color: #e74c3c;
            text-align: center;
            font-size: 18px;
        }
        .weather-item {
            margin: 10px 0;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
            text-align: left;
        }
        .weather-item strong {
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ëŒ€í•œë¯¼êµ­ ì‹¤ì‹œê°„ ì¼ê¸°ì˜ˆë³´</h1>
        <form id="weather-form">
            <div class="select-group">
                <select id="region-select">
                    <option value="">ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
                <select id="city-select" disabled>
                    <option value="">ì‹œ/êµ°/êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <button type="submit">ë‚ ì”¨ í™•ì¸</button>
        </form>
        <div id="weather-info">
            <p>ê¶ê¸ˆí•œ ì§€ì—­ì„ ì„ íƒí•˜ê³  í˜„ì¬ ë‚ ì”¨ë¥¼ í™•ì¸í•˜ì„¸ìš”! â˜€ï¸</p>
        </div>
    </div>

    <script>
        const serviceKey = 'OaRLlfpKOXJH%2BFeghkAojoaSAQbb1bkFF9COvGfjixpiLkEYTHFLqIcBYqFb0HCrcX8H3A47X9QNiRpgcCXAOA%3D%3D'; 
        
        const form = document.getElementById('weather-form');
        const regionSelect = document.getElementById('region-select');
        const citySelect = document.getElementById('city-select');
        const weatherInfo = document.getElementById('weather-info');

        const gridData = {
            'íŠ¹ë³„ì‹œ': {
                'ì„œìš¸íŠ¹ë³„ì‹œ': { nx: 60, ny: 127 }
            },
            'ê´‘ì—­ì‹œ': {
                'ë¶€ì‚°ê´‘ì—­ì‹œ': { nx: 98, ny: 76 },
                'ëŒ€êµ¬ê´‘ì—­ì‹œ': { nx: 89, ny: 90 },
                'ì¸ì²œê´‘ì—­ì‹œ': { nx: 55, ny: 124 },
                'ê´‘ì£¼ê´‘ì—­ì‹œ': { nx: 58, ny: 74 },
                'ëŒ€ì „ê´‘ì—­ì‹œ': { nx: 67, ny: 100 },
                'ìš¸ì‚°ê´‘ì—­ì‹œ': { nx: 102, ny: 84 }
            },
            'íŠ¹ë³„ìì¹˜ì‹œ': {
                'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': { nx: 66, ny: 103 }
            },
            'ê²½ê¸°ë„': {
                'ìˆ˜ì›ì‹œ': { nx: 60, ny: 121 }, 'ê³ ì–‘ì‹œ': { nx: 57, ny: 127 },
                'ìš©ì¸ì‹œ': { nx: 63, ny: 120 }, 'ì„±ë‚¨ì‹œ': { nx: 62, ny: 123 },
                'ë¶€ì²œì‹œ': { nx: 56, ny: 124 }, 'ì•ˆì‚°ì‹œ': { nx: 58, ny: 121 },
                'í™”ì„±ì‹œ': { nx: 59, ny: 119 }, 'ë‚¨ì–‘ì£¼ì‹œ': { nx: 63, ny: 128 },
                'í‰íƒì‹œ': { nx: 60, ny: 113 }, 'ì•ˆì–‘ì‹œ': { nx: 59, ny: 122 },
                'ì‹œí¥ì‹œ': { nx: 58, ny: 121 }, 'ê¹€í¬ì‹œ': { nx: 53, ny: 124 },
                'ì˜ì •ë¶€ì‹œ': { nx: 61, ny: 128 }, 'í•˜ë‚¨ì‹œ': { nx: 63, ny: 126 },
                'ê´‘ì£¼ì‹œ': { nx: 63, ny: 123 }, 'ê´‘ëª…ì‹œ': { nx: 58, ny: 125 },
                'íŒŒì£¼ì‹œ': { nx: 54, ny: 128 }, 'êµ¬ë¦¬ì‹œ': { nx: 61, ny: 127 },
                'ì˜¤ì‚°ì‹œ': { nx: 60, ny: 118 }, 'êµ°í¬ì‹œ': { nx: 59, ny: 122 },
                'ì´ì²œì‹œ': { nx: 79, ny: 104 }, 'ì–‘ì£¼ì‹œ': { nx: 61, ny: 129 },
                'ì•ˆì„±ì‹œ': { nx: 65, ny: 114 }, 'ë™ë‘ì²œì‹œ': { nx: 61, ny: 132 },
                'ê³¼ì²œì‹œ': { nx: 61, ny: 124 }, 'ì˜ì™•ì‹œ': { nx: 60, ny: 122 },
                'í¬ì²œì‹œ': { nx: 65, ny: 130 }, 'ì—¬ì£¼ì‹œ': { nx: 80, ny: 113 }
            },
            'ê°•ì›íŠ¹ë³„ìì¹˜ë„': {
                'ì¶˜ì²œì‹œ': { nx: 73, ny: 133 }, 'ì›ì£¼ì‹œ': { nx: 77, ny: 126 },
                'ê°•ë¦‰ì‹œ': { nx: 92, ny: 131 }, 'ë™í•´ì‹œ': { nx: 98, ny: 122 },
                'íƒœë°±ì‹œ': { nx: 94, ny: 122 }, 'ì†ì´ˆì‹œ': { nx: 81, ny: 137 },
                'ì‚¼ì²™ì‹œ': { nx: 98, ny: 120 }
            },
            'ì¶©ì²­ë¶ë„': {
                'ì²­ì£¼ì‹œ': { nx: 69, ny: 107 }, 'ì¶©ì£¼ì‹œ': { nx: 79, ny: 107 },
                'ì œì²œì‹œ': { nx: 89, ny: 117 }
            },
            'ì¶©ì²­ë‚¨ë„': {
                'ì²œì•ˆì‹œ': { nx: 67, ny: 104 }, 'ê³µì£¼ì‹œ': { nx: 66, ny: 98 },
                'ë³´ë ¹ì‹œ': { nx: 60, ny: 98 }, 'ì•„ì‚°ì‹œ': { nx: 65, ny: 104 },
                'ì„œì‚°ì‹œ': { nx: 59, ny: 104 }, 'ë…¼ì‚°ì‹œ': { nx: 64, ny: 88 },
                'ê³„ë£¡ì‹œ': { nx: 66, ny: 100 }, 'ë‹¹ì§„ì‹œ': { nx: 61, ny: 106 }
            },
            'ì „ë¶íŠ¹ë³„ìì¹˜ë„': {
                'ì „ì£¼ì‹œ': { nx: 63, ny: 89 }, 'êµ°ì‚°ì‹œ': { nx: 52, ny: 83 },
                'ìµì‚°ì‹œ': { nx: 60, ny: 82 }, 'ì •ìì‹œ': { nx: 54, ny: 79 },
                'ë‚¨ì›ì‹œ': { nx: 74, ny: 78 }, 'ê¹€ì œì‹œ': { nx: 57, ny: 84 }
            },
            'ì „ë¼ë‚¨ë„': {
                'ëª©í¬ì‹œ': { nx: 50, ny: 66 }, 'ì—¬ìˆ˜ì‹œ': { nx: 74, ny: 64 },
                'ìˆœì²œì‹œ': { nx: 72, ny: 66 }, 'ë‚˜ì£¼ì‹œ': { nx: 58, ny: 78 },
                'ê´‘ì–‘ì‹œ': { nx: 73, ny: 68 }
            },
            'ê²½ìƒë¶ë„': {
                'í¬í•­ì‹œ': { nx: 106, ny: 94 }, 'ê²½ì£¼ì‹œ': { nx: 101, ny: 85 },
                'ê¹€ì²œì‹œ': { nx: 73, ny: 97 }, 'ì•ˆë™ì‹œ': { nx: 91, ny: 106 },
                'êµ¬ë¯¸ì‹œ': { nx: 86, ny: 98 }, 'ì˜ì£¼ì‹œ': { nx: 90, ny: 118 },
                'ì˜ì²œì‹œ': { nx: 96, ny: 88 }, 'ìƒì£¼ì‹œ': { nx: 75, ny: 102 },
                'ë¬¸ê²½ì‹œ': { nx: 82, ny: 110 }, 'ê²½ì‚°ì‹œ': { nx: 91, ny: 88 }
            },
            'ê²½ìƒë‚¨ë„': {
                'ì°½ì›ì‹œ': { nx: 90, ny: 77 }, 'ì§„ì£¼ì‹œ': { nx: 74, ny: 78 },
                'í†µì˜ì‹œ': { nx: 81, ny: 70 }, 'ì‚¬ì²œì‹œ': { nx: 73, ny: 76 },
                'ê¹€í•´ì‹œ': { nx: 90, ny: 77 }, 'ë°€ì–‘ì‹œ': { nx: 91, ny: 80 },
                'ê±°ì œì‹œ': { nx: 83, ny: 68 }, 'ì–‘ì‚°ì‹œ': { nx: 92, ny: 81 }
            },
            'ì œì£¼íŠ¹ë³„ìì¹˜ë„': {
                'ì œì£¼ì‹œ': { nx: 52, ny: 38 }, 'ì„œê·€í¬ì‹œ': { nx: 53, ny: 36 }
            }
        };

        // ì‹œ/ë„ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì´ˆê¸°í™”
        function initRegionSelect() {
            for (const region in gridData) {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
            }
        }
        initRegionSelect();

        // ì‹œ/ë„ ì„ íƒ ì‹œ ì‹œ/êµ°/êµ¬ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì—…ë°ì´íŠ¸
        regionSelect.addEventListener('change', function() {
            const selectedRegion = regionSelect.value;
            citySelect.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            citySelect.disabled = true;

            if (selectedRegion && gridData[selectedRegion]) {
                const cities = gridData[selectedRegion];
                for (const city in cities) {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                }
                citySelect.disabled = false;
            }
        });

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const region = regionSelect.value;
            const city = citySelect.value;
            
            if (region && city) {
                getWeather(region, city);
            } else {
                weatherInfo.innerHTML = `<p class="error">ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”. ğŸ™ï¸</p>`;
            }
        });

        async function getWeather(region, city) {
            weatherInfo.innerHTML = '<p class="loading">í˜„ì¬ ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ğŸ“¡</p>';

            const grid = gridData[region][city];
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const baseDate = `${year}${month}${day}`;
            const baseTime = getUltraSrtNcstBaseTime(now);

            const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst?serviceKey=${serviceKey}&pageNo=1&numOfRows=100&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${grid.nx}&ny=${grid.ny}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.response.header.resultCode === "00") {
                    const items = data.response.body.items.item;
                    if (items && items.length > 0) {
                        const parsedBaseDate = items[0].baseDate;
                        const parsedBaseTime = items[0].baseTime;
                        displayWeather(region, city, items, parsedBaseDate, parsedBaseTime);
                    } else {
                        weatherInfo.innerHTML = `<p class="error">í˜„ì¬ ë‚ ì”¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (ë°ì´í„°ê°€ ì•„ì§ ê°±ì‹ ë˜ì§€ ì•Šì•˜ê±°ë‚˜, ìš”ì²­ ì‹œê°„ì´ ë§ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤) ğŸ˜”</p>`;
                    }
                } else {
                    throw new Error(data.response.header.resultMsg);
                }
            } catch (error) {
                console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                weatherInfo.innerHTML = `<p class="error">ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message} ğŸ˜¢</p>`;
            }
        }

        function getUltraSrtNcstBaseTime(date) {
            let hour = date.getHours();
            let minute = date.getMinutes();
            if (minute < 30) {
                hour = hour - 1;
                if (hour < 0) {
                    hour = 23; 
                }
            }
            return String(hour).padStart(2, '0') + '00';
        }

        function displayWeather(region, city, items, baseDate, baseTime) {
            const weatherData = {};
            items.forEach(item => {
                weatherData[item.category] = item.obsrValue;
            });
            
            const skyStatus = getSkyStatus(weatherData['SKY']);
            const rainType = getRainType(weatherData['PTY']);

            const html = `
                <h2>${region} ${city} í˜„ì¬ ë‚ ì”¨</h2>
                <div class="weather-item">
                    <p><strong>ë°œí‘œ ì‹œê°:</strong> ${baseDate} ${baseTime.slice(0, 2)}:${baseTime.slice(2, 4)}</p>
                    <p><strong>í•˜ëŠ˜ ìƒíƒœ:</strong> ${skyStatus || 'ì •ë³´ì—†ìŒ'}</p>
                    <p><strong>ê°•ìˆ˜ í˜•íƒœ:</strong> ${rainType || 'ì •ë³´ì—†ìŒ'}</p>
                    <p><strong>ê¸°ì˜¨:</strong> ${weatherData['T1H'] || 'ì •ë³´ì—†ìŒ'}â„ƒ</p>
                    <p><strong>ìŠµë„:</strong> ${weatherData['REH'] || 'ì •ë³´ì—†ìŒ'}%</p>
                    <p><strong>í’ì†:</strong> ${weatherData['WSD'] || 'ì •ë³´ì—†ìŒ'}m/s</p>
                </div>
            `;
            weatherInfo.innerHTML = html;
        }

        function getSkyStatus(value) {
            if (value === '1') return 'ë§‘ìŒâ˜€ï¸';
            if (value === '3') return 'êµ¬ë¦„ë§ìŒâ˜ï¸';
            if (value === '4') return 'íë¦¼ğŸŒ«ï¸';
            return '';
        }

        function getRainType(value) {
            if (value === '0') return 'ì—†ìŒ';
            if (value === '1') return 'ë¹„â˜”';
            if (value === '2') return 'ë¹„/ëˆˆ';
            if (value === '3') return 'ëˆˆâ„ï¸';
            if (value === '4') return 'ì†Œë‚˜ê¸°ğŸŒ§ï¸';
            if (value === '5') return 'ë¹—ë°©ìš¸';
            if (value === '6') return 'ë¹—ë°©ìš¸/ëˆˆë‚ ë¦¼';
            if (value === '7') return 'ëˆˆë‚ ë¦¼';
            return '';
        }
    </script>
</body>
</html>